<?php
// register.php

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $username = trim($_POST['username']);
    $password = $_POST['password'];

    // Validate username (must not be empty)
    if (empty($username)) {
        die("Username cannot be empty.");
    }

    // Check if username already exists
    if (file_exists("users.txt")) {
        $users = file("users.txt", FILE_IGNORE_NEW_LINES);
        foreach ($users as $user) {
            list($savedUser, $savedHash) = explode(":", $user);
            if ($savedUser === $username) {
                die("Username already exists. Please choose another.");
            }
        }
    }

    // Validate password
    if (strlen($password) < 8 || strlen($password) > 12) {
        die("Password must be 8 to 12 characters long.");
    }
    if (!preg_match("/[0-9]/", $password)) {
        die("Password must contain at least one number.");
    }
    if (!preg_match("/[\W_]/", $password)) {
        die("Password must contain at least one symbol.");
    }

    // Hash the password using MD5
    $hashedPassword = md5($password);

    // Save user to users.txt
    file_put_contents("users.txt", $username . ":" . $hashedPassword . "\n", FILE_APPEND);

}
?>
<!DOCTYPE html>
<html>
<head>
    <title>Register</title>
    <style>
       body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }

        form {
            display: inline-block;
            padding: 20px;
            border: 1px solid #2f55ecff;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        input {
            display: block;
            margin: 10px 0;
            padding: 5px;
        }

        button {
            padding: 5px 10px;
            background-color: #2f55ecff;
            color: white;
        }

        a {
            display: block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <form method="POST" action="">
        <h2>Register</h2>
        <input type="text" name="username" placeholder="Username" required>
        <input type="password" name="password" placeholder="Password" required><br>
        <button type="submit">Register</button>
        <h6><a href='hashhh.php'>Go to login</a></h6>
    </form>
</body>
</html>
